# AI阿拉伯书法生成器 - 项目任务清单 (Todolist)

**最后更新日期：** 2025年5月27日

**基于文档版本：**

- **PRD:** 2.0
- **产品设计文档:** 1.5
- **功能与数据结构设计:** 1.2 (基于Shipixen模板)

## 阶段一：核心基础与MVP (Minimum Viable Product)

### 1. 项目设置与后端基础

- [ ] **任务1.1:** 项目初始化，选择技术栈 (后端语言、框架、数据库如PostgreSQL)。
- [ ] **任务1.2:** 数据库表结构创建与调整：
    - [ ] **1.2.1:** 确认并调整 `users` 表 (添加 `password_hash`, `status`, `current_credits` 等关键字段)。
    - [ ] **1.2.2:** 确认并调整 `orders` 表 (添加 `order_type` 等字段，明确 `product_id` 与新表的关联)。
    - [ ] **1.2.3:** 确认并调整 `credits` 表 (添加 `balance_after_transaction`, `description`, `related_artwork_id` 等字段)。
    - [ ] **1.2.4:** 创建新的核心表：`StyleTemplate`, `GeneratedArtwork`, `UploadedImage`, `SubscriptionPlan`。
    - [ ] **1.2.5:** (可选) 创建 `CreditPack` 表。
    - [ ] **1.2.6:** (可选，但建议) 创建 `UserActiveSubscription` 表或在 `users` 表中集成其核心字段。
- [ ] **任务1.3:** API基础架构搭建 (路由、认证中间件等)。
- [ ] **任务1.4:** CDN服务选型与基础配置。
- [ ] **任务1.5:** AI模型接口调研与初步集成准备 (确定调用方式、参数)。

### 2. 用户账户系统 (MVP)

- [ ] **任务2.1:** 用户注册功能 (邮箱+密码)。
    - [ ] **2.1.1:** 后端API实现 (含密码加密)。
    - [ ] **2.1.2:** 前端注册页面与逻辑。
    - [ ] **2.1.3:** 注册成功后自动登录。
    - [ ] **2.1.4:** 注册成功后赠送体验积分 (后端逻辑，更新 `users.current_credits` 及 `credits` 流水)。
- [ ] **任务2.2:** 用户登录功能 (邮箱+密码)。
    - [ ] **2.2.1:** 后端API实现 (含密码验证)。
    - [ ] **2.2.2:** 前端登录页面与逻辑。
    - [ ] **2.2.3:** JWT或其他Token生成与管理。
- [ ] **任务2.3:** 密码找回功能 (通过邮箱验证)。
- [ ] **任务2.4:** 用户登出功能。
- [ ] **任务2.5:** `users.current_credits` 字段的后端维护逻辑 (确保原子性操作)。
- [ ] **任务2.6:** `credits` 表的积分流水记录基础功能 (注册赠送)。

### 3. AI书法生成核心流程 (MVP - 文生图优先)

- [ ] **任务3.1:** 风格模板管理 (后端)。
    - [ ] **3.1.1:** `StyleTemplate` 表的CRUD API (初期可后台手动录入数据)。
    - [ ] **3.1.2:** 至少定义3-5个高质量的初始风格模板 (包含 `base_system_prompt` 和 `preview_image_url`)。
- [ ] **任务3.2:** 创作页 - 文生图模式 (MVP)。
    - [ ] **3.2.1:** 前端界面搭建 (参考产品设计文档2.1节)。
        - [ ] 默认风格加载与显示。
        - [ ] "更换风格"按钮及弹出的风格选择面板 (从后端获取风格列表)。
        - [ ] 阿拉伯文本输入框。
        - [ ] "生成作品"按钮。
        - [ ] 生成结果展示区 (直接在页面下方)。
    - [ ] **3.2.2:** 后端API - 文生图接口。
        - [ ] 接收文本、风格ID、(可选)基础参数。
        - [ ] 验证用户积分。
        - [ ] 调用AI模型。
        - [ ] 处理AI返回结果，图片上传至CDN。
        - [ ] 保存 `GeneratedArtwork` 记录。
        - [ ] 扣除积分 (更新 `users.current_credits` 及 `credits` 流水)。
        - [ ] 返回图像URL给前端。
    - [ ] **3.2.3:** "生成中"等待状态/遮罩层实现 (前端与后端状态同步)。
- [ ] **任务3.3:** 生成结果交互 (MVP)。
    - [ ] **3.3.1:** 下载作品按钮 (基础分辨率，可能带水印)。
    - [ ] **3.3.2:** (登录后) 收藏作品按钮 (更新 `GeneratedArtwork.is_favorited`)。

### 4. 支付与订阅系统 (MVP - 至少一个付费套餐)

- [ ] **任务4.1:** 订阅套餐定义。
    - [ ] **4.1.1:** `SubscriptionPlan` 表的CRUD API (初期可后台手动录入数据)。
    - [ ] **4.1.2:** 定义至少一个付费订阅套餐 (如"基础版月付")，明确价格、授予积分、权益。
- [ ] **任务4.2:** 套餐与定价页前端展示 (参考产品设计文档2.3节)。
- [ ] **任务4.3:** 支付网关集成 (以Stripe为例)。
    - [ ] **4.3.1:** 后端创建订单API (生成`orders`记录，状态`pending_payment`)。
    - [ ] **4.3.2:** 调用Stripe创建Checkout Session或Payment Intent。
    - [ ] **4.3.3:** 前端跳转Stripe支付页面。
    - [ ] **4.3.4:** 后端Webhook接收Stripe支付成功/失败通知。
    - [ ] **4.3.5:** 支付成功后的处理逻辑：
        - [ ] 更新`orders`状态为`paid`，记录`paid_at`, `sub_id`等。
        - [ ] 授予用户积分 (更新`users.current_credits`及`credits`流水，关联`order_no`)。
        - [ ] 更新用户订阅状态 (更新`users.active_subscription_order_no`, `users.subscription_expires_at`或`UserActiveSubscription`表)。
- [ ] **任务4.4:** 用户中心 - 我的订阅页面 (MVP - 显示当前订阅状态和到期日)。

### 5. 用户中心 (MVP)

- [ ] **任务5.1:** 个人资料查看与基础修改 (昵称、头像)。
- [ ] **任务5.2:** 积分钱包页面 (显示当前积分、积分明细列表 - 从`credits`表读取)。
- [ ] **任务5.3:** 我的作品页面 (MVP - 展示已收藏的作品列表，支持查看和删除)。

## 阶段二：功能增强与体验优化

### 6. AI书法生成功能增强

- [ ] **任务6.1:** 图生图模式实现。
    - [ ] **6.1.1:** 创作页模式切换Tab (文生图/图生图)。
    - [ ] **6.1.2:** 图生图模式下的参考图像上传功能 (`UploadedImage`表)。
    - [ ] **6.1.3:** "继续调整此图"按钮逻辑：
        - [ ] 将选中作品设为参考图，切换至图生图模式。
        - [ ] 用户输入新的文本提示。
    - [ ] **6.1.4:** 后端API - 图生图接口 (逻辑类似文生图，但增加参考图输入)。
- [ ] **任务6.2:** (可选) "一键变体"功能实现。
- [ ] **任务6.3:** (可选) 创作页基础参数调整功能 (画面比例、生成数量、色彩模式)。
- [ ] **任务6.4:** 更多高质量风格模板上线。
- [ ] **任务6.5:** 创作页历史生成作品快速回顾区实现。

### 7. 用户账户与订阅系统完善

- [ ] **任务7.1:** 第三方社交账户登录/注册。
- [ ] **任务7.2:** 订阅管理功能完善 (升级套餐、管理自动续费、取消订阅)。
- [ ] **任务7.3:** (可选) 积分充值包功能 (`CreditPack`表及购买流程)。
- [ ] **任务7.4:** 账户安全功能 (修改密码、绑定/解绑邮箱/手机)。
- [ ] **任务7.5:** 积分过期逻辑实现 (若`credits.expired_at`字段启用)。

### 8. 内容输出与体验优化

- [ ] **任务8.1:** 下载作品功能完善 (根据订阅等级提供不同分辨率、透明背景、去水印)。
- [ ] **任务8.2:** "生成中"等待状态的视觉与信息优化 (如加入趣味内容)。
- [ ] **任务8.3:** 风格库/灵感画廊页面实现 (独立页面或更完善的模态窗口)。
- [ ] **任务8.4:** 响应式设计与移动端适配全面测试与优化。
- [ ] **任务8.5:** 空白状态与新用户引导优化。

## 阶段三：运营与未来拓展

### 9. 运营与分析

- [ ] **任务9.1:** 后台管理系统搭建/完善。
    - [ ] 用户管理 (查看、状态修改、积分调整)。
    - [ ] 订单管理。
    - [ ] 风格模板管理。
    - [ ] 数据统计与分析看板 (用户增长、活跃度、付费转化、积分消耗等)。
- [ ] **任务9.2:** 邮件通知系统 (注册欢迎、购买成功、订阅提醒等)。
- [ ] **任务9.3:** SEO优化基础。

### 10. 未来功能 (根据PRD未来展望)

- [ ] **任务10.1:** 社区功能 (作品分享、点赞、评论)。
- [ ] **任务10.2:** API开放 (`apikeys`表)。
- [ ] **任务10.3:** 博客/文章功能 (`posts`表)。
- [ ] **任务10.4:** 更多AI模型集成。
- [ ] **任务10.5:** 移动端原生App规划。

## 持续性任务：

- [ ] Bug修复与性能优化。
- [ ] 用户反馈收集与迭代。
- [ ] 安全性审计与加固。
- [ ] 文档维护。